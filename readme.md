# 平衡引擎 (Balance Engine) - 游戏策划专用数值测试工具

## 更新日志

### 最新版本 (v1.1.0) - 2024-03-15

#### 核心功能改进
- **属性计算系统增强**：重构了属性计算逻辑，支持更灵活的参数配置和成长曲线应用
- **独立属性成长曲线**：每个属性现在可以设置独立的成长曲线类型和参数，提供更精细的数值控制
- **动态属性管理优化**：改进了属性的添加和访问机制，支持更灵活的自定义属性扩展
- **错误处理机制**：添加了成长曲线计算的错误捕获和fallback机制，提高系统稳定性

#### 技术升级
- **数据存储迁移**：从XML迁移到SQLite数据库，提高数据处理效率和可靠性
- **模块化设计优化**：进一步降低了模块间耦合度，提升代码可维护性
- **参数验证增强**：添加了更严格的参数验证和类型检查，减少运行时错误

#### 用户体验提升
- **更智能的默认值处理**：优化了属性默认值的加载机制，确保在配置缺失时仍能正常运行
- **更详细的错误提示**：提供更清晰的错误信息，帮助快速定位和解决问题

### 2025年11月9日更新

已完整实现基于XML存储架构的数值系统核心功能套件，包含以下关键模块：

1. **属性系统配置模块**
   - 支持通过结构化XML文件定义和管理所有游戏属性
   - 包括基础属性、派生属性及其相互依赖关系
   - 提供属性继承与覆盖机制

2. **命令行交互界面**
   - 实现了完整的命令行操作接口
   - 支持属性参数调整、数据导入导出和快速功能测试

3. **成长曲线模拟引擎**
   - 内置多种数学模型（线性、指数、对数、分段函数等）
   - 可精确模拟不同角色在各等级段的属性成长轨迹

4. **伤害公式验证工具**
   - 提供公式输入、参数化测试和结果分析功能
   - 确保战斗数值平衡性

5. **战斗数据模拟系统**
   - 支持多单位、多回合战斗场景模拟
   - 可生成详细的战斗过程日志和统计报告

6. **数据可视化与分析组件**
   - 自动生成多种图表展示属性成长趋势、伤害分布和战斗效率等关键指标
   - 支持多维度数据对比分析

### 2025年11月27日更新

系统架构全面升级，重点优化数据存储与交互体验：

1. **数据库存储模式革新**
   - 从XML迁移至SQLite关系型数据库
   - 设计了规范化的数据模型，实现实体间复杂关联关系管理
   - 支持事务操作和并发访问
   - 显著提升大数据量下的数据读写性能与系统稳定性

2. **数据管理功能增强**
   - 开发了完整的数据CRUD接口
   - 支持批量导入导出、数据备份恢复和版本管理
   - 新增数据校验机制确保数据一致性

3. **Web交互界面重构**
   - 采用Gradio框架构建直观易用的Web界面
   - 实现可视化操作流程，包括：
     - 属性配置表单
     - 曲线编辑器
     - 战斗模拟器
     - 数据看板等模块

4. **交互体验全方位优化**
   - 设计响应式布局适配不同设备
   - 简化操作流程减少点击次数
   - 添加实时预览和参数自动保存功能
   - 优化图表展示效果和数据筛选机制
   - 提供详细的操作指引和错误提示
   - 使系统操作门槛大幅降低，同时保持功能的专业性和灵活性

这是一款为游戏策划量身定制的RPG数值系统模拟与分析工具，核心价值在于帮助策划团队无需等待程序实现，就能快速验证、平衡和优化游戏中的数值体系，显著减少试错成本，提升游戏整体平衡性。

## 项目概述

在游戏开发过程中，数值平衡是一项既关键又耗时的工作。本工具是基于Python开发的轻量级解决方案，旨在解决游戏策划团队在数值设计中面临的核心痛点：传统开发流程中，策划需要等待程序实现后才能验证数值设计效果，这常常导致反复修改和时间浪费。

通过本模拟器，策划可以直接在程序实现前测试各种数值方案，直观观察不同属性搭配和成长模型的效果，快速迭代找到最佳平衡方案。同时，工具还提供了丰富的数据可视化和分析功能，帮助策划更科学地做出数值决策。

## 系统架构与可扩展性

作为一个基于Python开发的工具，项目采用高度模块化的设计理念，代码结构清晰，便于技术人员进行二次开发和功能扩展。整个系统由几个核心模块组成，每个模块职责明确，耦合度低，这使得修改或扩展任何部分都不会影响其他功能的正常运行。

核心目录结构：
- **core/**: 核心逻辑模块
  - `character.py`: 实现Character类，提供动态属性管理和成长计算
  - `damage.py`: 实现伤害计算系统，支持暴击、等级差异等机制
- **data/**: 数据处理模块
  - `sqlite_handler.py`: 提供SQLite数据库读写功能
- **logic/**: 业务逻辑模块
  - `battle.py`: 实现战斗模拟核心逻辑
  - `character_manager.py`: 管理角色数据和持久化
- **utils/**: 工具函数模块
  - `attribute_calculator.py`: 属性计算工具集
  - `growth_curve.py`: 实现多种成长曲线算法
  - `chart_generator.py`: 数据可视化图表生成
- **ui/**: 用户界面模块
  - `menu.py`: 交互式菜单实现
- **main/**: 应用入口
  - `app.py`: 主程序流程控制

## 核心功能

### 属性系统配置
属性系统支持通过配置文件定义和管理游戏属性，设置属性名称、默认值、范围和描述。

### 成长曲线模拟
成长曲线系统(`utils/growth_curve.py`)实现多种数学模型：

**核心函数结构：**
```python
def linear_curve(base_value, growth_factor, level, max_level):
    """线性成长曲线
    
    参数:
        base_value: 基础值
        growth_factor: 成长因子
        level: 当前等级
        max_level: 最大等级
    """
    return base_value + growth_factor * (level - 1)
```

支持线性、指数、对数、幂函数、S形和混合等多种曲线类型。

### 伤害公式验证
伤害计算系统(`core/damage.py`)支持基础伤害计算、暴击机制和等级差异调整：

**核心函数：**
```python
def calculate_damage(attacker, defender, skill_power=1.0):
    """计算伤害值，支持暴击判定和等级差异修正"""
    # 伤害计算逻辑
    pass
```

### 战斗数据模拟
战斗模拟系统(`logic/battle.py`)支持单次和批量战斗分析，自动统计平均伤害、暴击率等指标。

### 数据可视化与分析
数据可视化模块(`utils/chart_generator.py`)生成属性成长曲线和战斗统计图表，支持CSV导出。

### 角色批量生成
角色管理系统支持手动创建和批量生成测试角色，便于快速构建测试场景。

## 快速开始

作为基于Python开发的工具，使用起来非常简单。首先确保你的电脑上安装了Python 3.7或更高版本（无需编程知识，仅需安装环境），然后在项目目录下安装必要的依赖包。运行以下命令：

```bash
pip install -r requirements.txt
```

安装完成后，首次运行时系统会自动创建默认的属性配置文件。直接在命令行中输入以下命令启动程序：

```bash
python run.py
```

启动后将看到交互式菜单，你可以通过输入对应的数字来选择不同的功能模块。整个操作流程设计得非常直观，即使是不熟悉编程的策划人员也能轻松上手。

## 使用指南

### 角色管理

角色管理：创建特定属性角色、批量生成多配置角色或随机属性角色。

### 战斗模拟

战斗模拟：支持单场或批量对战（推荐1000+次），统计平均伤害、暴击率、胜率等指标。

### 属性分析

属性分析：预览成长曲线、对比多曲线效果、测试特定等级段变化、分析属性对战斗的影响权重。

## 策划使用指南

### 属性配置文件（策划工作流）

**配置文件说明：**
- `attributes_config.xml`: 定义属性名称、范围和游戏内意义

### 角色数据管理

- `characters.xml`: 保存测试角色配置，支持团队共享

### 策划工作流程建议

1. **需求定义**：明确游戏的核心数值体系目标
2. **基础配置**：设置属性和成长曲线
3. **原型测试**：创建测试角色并进行初步模拟
4. **参数调整**：修改关键参数并观察效果
5. **批量验证**：进行大量模拟验证平衡性
6. **数据分析**：使用生成的图表和数据支持决策
7. **文档输出**：将验证后的数值整理成正式文档

## 代码可扩展性详解

### 代码可扩展设计

**Character类扩展 (`core/character.py`)**：
```python
class Character:
    def __init__(self, name, level=1):
        self.name = name
        self.level = level
        self.attributes = {}
        
    def get_attribute(self, attr_name):
        """获取属性值，支持派生属性计算"""
        # 实现逻辑
```

**数据处理扩展**：可在`data/sqlite_handler.py`基础上添加新的数据存储后端。

**自定义战斗机制**：在`logic/battle.py`中扩展战斗流程。

## 输出成果

**输出目录：** `output_charts/`
- 属性数据CSV文件（Excel兼容）
- 成长曲线PNG图表（直接用于策划文档）

## 二次开发建议

1. **保持接口一致**：新增功能遵循现有函数签名和返回值规范
2. **充分测试**：使用系统模拟功能验证数值修改效果
3. **添加文档**：为新函数和类提供清晰注释
4. **避免过度耦合**：保持模块间低依赖设计

## 总结

平衡引擎为游戏策划提供灵活的数值测试环境，支持多种成长模型、伤害计算和战斗模拟。通过该工具，可在正式开发前验证数值系统，降低调整成本。

模块化设计确保了良好的可扩展性，技术团队可轻松根据项目需求进行定制开发。

## License

MIT License
